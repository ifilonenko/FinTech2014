{% extends "polls/base_polls.html" %}
{% load relationship_tags %}
{% load staticfiles %}

{% block title %}
{{ user.username }} profile
{% endblock %}

{% block body %}

<div id="wrap">

  {% include "polls/navbar.html" %}
  {% include "classes/class_modals.html" %}

  <div class="container" id="body">
    <div class="row">
      <div class="col-md-9 col-md-offset-1">

        <h2>{{ user_profile.first_name }} {{ user_profile.last_name }}</h2>
        <div class="pull-right">
          {% if user.username == user_profile.username %}
          <a href="#" class="btn btn-default"><span class="glyphicon glyphicon-user"></span> It's you!</a>
          {% else %}
          {% if_relationship user user_profile "following" %}
          <a href="javascript:;" onclick="manage_relationship('{% url 'accounts:user_unfollow' user_profile %}')" class="btn btn-default btn-danger"><span class="glyphicon glyphicon-minus-sign"></span> Unfollow</a>
          {% else %}
          <a href="javascript:;" onclick="manage_relationship('{% url 'accounts:user_follow' user_profile %}')" class="btn btn-default btn-success"><span class="glyphicon glyphicon-plus-sign"></span> Follow</a>
          {% endif_relationship %}

          {% endif %}
        </div>

        <ul class="nav nav-tabs" id="userProfileTabs">

          <li class="active"><a href="" data-toggle="tab" data-url="{% url 'accounts:user_corks' user_profile %}">Corks</a></li>
          <li><a href="" data-toggle="tab" data-url="{% url 'accounts:user_baskets' user_profile %}">Baskets</a></li>

          <li class="dropdown">
            <a href="#" id="users_classes_dropdown" class="dropdown-toggle" data-toggle="dropdown">Classes <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="users_classes_dropdown">
              <li><a href="#classes_taking" data-toggle="tab" data-url="{% url 'accounts:user_classes' user_profile 'taking' %}">Classes taking</a></li>
              <li><a href="#classes_teaching" data-toggle="tab" data-url="{% url 'accounts:user_classes' user_profile 'teaching' %}">Classes teaching</a></li>
            </ul>
          </li>

          <li><a href="#following" data-toggle="tab" data-url="{% url 'accounts:user_relationships' user_profile 'following' %}">Following <span class="badge">{{ user_profile.relationships.following.count }}</span></a></li>
          <li><a href="#followers" data-toggle="tab" data-url="{% url 'accounts:user_relationships' user_profile 'followers' %}">Followers <span class="badge">{{ user_profile.relationships.followers.count }}</span></a></li>

        </ul>

        <!-- Tab panes -->
        <div class="tab-content">

          <div class="tab-pane active" id="pane_container">
            <div id="loader"><img src="/static/polls/css/images/loader.gif"/></div> 
            <div id="items">
              
            </div>
          </div>


        </div>
      </div>

    </div>

  </div>
  </div>

  {% endblock %}
  {% block optional_js %}

  <script src="{% static "users/js/profile_page.js" %}" type="text/javascript"></script>

<script>

$(document).ready(function(e) {

var $container = $('#items');

$container.imagesLoaded( function(){
  $container.masonry({
    itemSelector : '.item'
  });
});

  // init when opens page
  var url = $('#userProfileTabs .active a').attr('data-url');
  get_tab(url, 1);

  $('#userProfileTabs a').click(function (e) {
    e.preventDefault();
    var url = $(this).attr("data-url");
    if ($(this).parent().attr('class') == "active" || url == null) return;  
    get_tab(url, 1);
  });

});

</script>

  <script type="text/javascript">
    $(document).ready(function(e) {
        $('.selectpicker').selectpicker();
    });
</script> 
  {% endblock %}