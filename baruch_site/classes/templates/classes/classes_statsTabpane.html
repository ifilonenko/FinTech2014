{% load vote_extras %}

{% if show %}
<p></p>
<div class="panel-group" id="accordion">
  {% for basket_class in basket_classes %}
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse{{forloop.counter}}">
          {{basket_class.basket.name}}
          {% if basket_class.open_for_voting %}
          <kbd style="float:right">Open for Voting!</kbd>
          {% endif %}
        </a>
      </h4>
    </div>
    
      <div id="loader" style="display: none"><img src="/static/polls/css/images/loader.gif"/></div>

      <div id="collapse{{forloop.counter}}" class="panel-collapse collapse {% if basket_class.open_for_voting %}in{%endif%} outer_accordion" tclass="{{basket_class.tclass.id}}" basket="{{basket_class.basket.id}}" URL="{% url 'classes:get_stats_for_basket_in_class' %}">
        
        <div class="panel-body">
          <!-- Accordion for corks -->
          <div class="panel-group" id="accordion_corks">
            {% if basket_class.open_for_voting %}
            {% for cork_basket in cork_baskets %}
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h5 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion_corks" href="#collapse_cork{{basket_class.id}}loop{{forloop.counter}}">
                      {{cork_basket.cork.question}}
                      {% if basket_class.open_for_voting and basket_class.cork_to_vote_on.cork == cork_basket.cork %}
                        <kbd style="float:right">Open</kbd>
                      {%endif%}
                    </a>
                  </h5>
                </div>
              </div>

              <div id="collapse_cork{{basket_class.id}}loop{{forloop.counter}}" class="panel-collapse collapse {% if basket_class.cork_to_vote_on.cork == cork_basket.cork %}in{%endif%}">
                <div class="panel-body">
                  <!-- Stats for this class -->
                  <div class="">
                    <strong><u>First Vote</u></strong>
                    <table class="table table-bordered table-hover" data-graph-container-before="1" data-graph-type="column" style="display:none">
                      <thead>
                        <tr>
                          <th>Choice</th>
                          <th># of Votes</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for choice in cork_basket.cork.choice_set.all %}

                        <tr>
                          <td>{{choice.choice_text}}</td>
                          <td>{{cork_basket|get_votes:choice|filter_voting_round:False}}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>

                    <strong><u>Second Vote</u></strong>
                    <table class="table table-bordered table-hover" data-graph-container-before="1" data-graph-type="column" style="display:none">
                      <thead>
                        <tr>
                          <th>Choice</th>
                          <th># of Votes</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for choice in cork_basket.cork.choice_set.all %}

                        <tr>
                          <td>{{choice.choice_text}}</td>
                          <td>{{cork_basket|get_votes:choice|filter_voting_round:True}}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>

                </div>
              </div>
            {% endfor %}
            
            {% endif %}
          </div>
          <!-- End accordion for corks -->

        </div>
      </div>


  </div>
  {% endfor %}
</div>

{% else %}
<p>Nothing to see here.</p>

{% endif %}


<script>
$(window).ready(function() {
  load_stats_tab();
  plot_bar_graphs();
})
</script>

